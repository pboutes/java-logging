buildscript {
    ext {
        logbackVersion = '1.2.3';
    }
}

plugins {
    id 'java'
    id 'application'
    id 'com.google.cloud.tools.jib' version '1.8.0'
}


group 'net.xeraa'
version '1.0'

sourceCompatibility = 1.8
mainClassName = 'net.xeraa.logging.LogMe'

repositories {
    mavenCentral()
}

dependencies {
    compile "org.slf4j:slf4j-api:1.7.29",
            "ch.qos.logback:logback-core:${logbackVersion}",
            "ch.qos.logback:logback-classic:${logbackVersion}",
            "ch.qos.logback:logback-access:${logbackVersion}",
            "com.fasterxml.jackson.core:jackson-core:2.10.1",
            "net.logstash.logback:logstash-logback-encoder:6.3"
}

jib {
    to {
        image = 'docker.io/paulboutes/pboutes-demo-logging'
    }
}

// Build a fat JAR and automatically run the main class in LogMe
jar {
    from {
        configurations.compile.collect { it.isDirectory() ? it : zipTree(it) }
    }
    manifest {
        attributes(
                'Class-Path': configurations.compile.collect { it.getName() }.join(' '),
                'Main-Class': 'net.xeraa.logging.LogMe'
        )
    }
}
